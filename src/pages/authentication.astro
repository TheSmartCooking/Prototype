---
import '../styles/global.css'
import Main from '../layouts/Main.astro'
import IconCheck from '../assets/icon/check.svg'
import IconHidePassword from '../assets/icon/eye-off.svg'
import IconShowPassword from '../assets/icon/eye.svg'
import IconX from '../assets/icon/x.svg'
---

<Main title="Authentication">
    <div id="authentication">
        <section id="login">
            <h2>Login</h2>
            <form action="#">
                <div class="form-field">
                    <input type="email" id="login-email" name="login-email" required />
                    <label for="login-email">E-mail</label>
                </div>

                <div class="form-field">
                    <div class="input-with-icon">
                        <input type="password" id="login-password" name="login-password" required />
                        <label for="login-password">Password</label>
                        <div class="icons" title="Toggle password visibility">
                            <IconShowPassword class="show-password" />
                            <IconHidePassword class="hide-password" />
                        </div>
                    </div>
                </div>
                <button type="submit">Login</button>
            </form>

            <a href="" id="register-link">
                Don't have an account? <span class="flip-link">Register</span>
            </a>
        </section>

        <section id="register" style="display: none;">
            <h2>Register</h2>
            <form action="#">
                <div class="form-field">
                    <input type="text" id="register-username" name="register-username" required />
                    <label for="register-username">Username</label>
                </div>

                <div class="form-field">
                    <input type="email" id="register-email" name="register-email" required />
                    <label for="register-email">E-mail</label>
                </div>

                <div class="form-field">
                    <div class="input-with-icon">
                        <input
                            type="password"
                            id="register-password"
                            name="register-password"
                            required
                        />
                        <label for="register-password">Password</label>
                        <div class="icons" title="Toggle password visibility">
                            <IconShowPassword class="show-password" />
                            <IconHidePassword class="hide-password" />
                        </div>
                    </div>
                </div>

                <div class="form-field">
                    <div class="input-with-icon">
                        <input
                            type="password"
                            id="register-password-confirm"
                            name="register-password-confirm"
                            required
                        />
                        <label for="register-password-confirm">Password confirmation</label>
                        <div class="icons" title="Toggle password visibility">
                            <IconShowPassword class="show-password" />
                            <IconHidePassword class="hide-password" />
                        </div>
                    </div>
                </div>

                <div id="password-requirements">
                    <h3>Password requirements</h3>
                    <ul>
                        <li>
                            <IconCheck class="password-requirement-check" />
                            <IconX class="password-requirement-x" />
                            <span>At least 12 characters long.</span>
                        </li>
                        <li>
                            <IconCheck class="password-requirement-check" />
                            <IconX class="password-requirement-x" />
                            <span> Contains at least one uppercase letter (A-Z). </span>
                        </li>
                        <li>
                            <IconCheck class="password-requirement-check" />
                            <IconX class="password-requirement-x" />
                            <span> Contains at least one lowercase letter (a-z). </span>
                        </li>
                        <li>
                            <IconCheck class="password-requirement-check" />
                            <IconX class="password-requirement-x" />
                            <span>Contains at least one digit (0-9).</span>
                        </li>
                        <li>
                            <IconCheck class="password-requirement-check" />
                            <IconX class="password-requirement-x" />
                            <span>
                                Contains at least one special character (any non-alphanumeric
                                character).
                            </span>
                        </li>
                    </ul>
                </div>

                <button type="submit">Register</button>
            </form>

            <a href="" id="login-link">
                Already have an account? <span class="flip-link">Login</span>
            </a>
        </section>
    </div>
</Main>

<style>
    button[type='submit'] {
        color: white;
        cursor: pointer;
        background-color: var(--color-secondary);
        border: none;
        border-radius: var(--border-radius-large);
        font-size: 1rem;
        padding: 1rem 2rem;
    }

    form {
        align-items: center;
        display: flex;
        flex-direction: column;
        gap: var(--spacing-medium);
        height: 100%;
        justify-content: center;
        width: 100%;
    }

    section {
        background-color: light-dark(rgb(0 0 0 / 0.2), rgb(255 255 255 / 0.1));
        border-radius: var(--border-radius-large);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-medium);
        padding: var(--spacing-medium);
        width: clamp(320px, 100%, 500px);
    }

    ul {
        list-style: none;
    }

    ul > li {
        display: flex;
        gap: var(--spacing-small);
        align-items: center;
    }

    .flip-link {
        font-weight: bold;
    }

    .form-field {
        position: relative;
        width: 100%;
    }

    .form-field input {
        width: 100%;
        padding: 1rem 0.75rem 0.25rem;
        font-size: 1rem;
        background: transparent;
        border: none;
        border-bottom: 2px solid #888;
        color: white;
        outline: none;
    }

    .form-field label {
        position: absolute;
        top: 1rem;
        left: 0.75rem;
        color: #888;
        font-size: 1rem;
        pointer-events: none;
        transition: 0.2s ease all;
    }

    .form-field input:focus + label,
    .form-field input.filled + label {
        top: -0.5rem;
        left: 0.5rem;
        font-size: 0.75rem;
        color: var(--color-secondary);
    }

    .form-field input:focus {
        border-bottom-color: var(--color-secondary);
    }

    .hide-password,
    .password-requirement-check {
        display: none;
    }

    .show-password {
        color: #888;
    }

    .icons {
        cursor: pointer;
    }

    .input-with-icon {
        display: flex;
    }

    .password-requirement-check,
    .password-requirement-x {
        width: 1.75rem;
        min-width: 1.75rem;
    }

    .password-requirement-check {
        color: var(--color-success);
    }

    .password-requirement-x {
        color: var(--color-error);
    }

    #authentication {
        align-items: center;
        display: flex;
        justify-content: center;
        height: 100%;
        width: 100%;
    }

    /* Pseudo-classes */

    button[type='submit']:hover {
        background-color: var(--color-primary);
    }

    @media screen and (width<=500px) {
        section {
            border-radius: 0;
        }
    }
</style>

<script type="module" is:inline>
    const loginSection = document.getElementById('login')
    const registerSection = document.getElementById('register')
    const loginLink = document.getElementById('register-link')
    const registerLink = document.getElementById('login-link')
    const passwordInput = document.getElementById('register-password')

    // Maintain label position on filled inputs
    document.querySelectorAll('.form-field input').forEach((input) => {
        const updateFilled = () => {
            input.classList.toggle('filled', input.value.trim() !== '')
        }

        input.addEventListener('input', updateFilled)
        input.addEventListener('blur', updateFilled)

        updateFilled()
    })

    // Flip between login and register forms
    loginLink.addEventListener('click', (e) => {
        e.preventDefault()
        loginSection.style.display = 'none'
        registerSection.style.display = 'flex'
    })

    registerLink.addEventListener('click', (e) => {
        e.preventDefault()
        registerSection.style.display = 'none'
        loginSection.style.display = 'flex'
    })

    // Toggle visibility for password fields
    document.querySelectorAll('.icons').forEach((iconContainer) => {
        const section = iconContainer.closest('section')
        const passwordInputs = section.querySelectorAll(
            'input[type="password"], input[type="text"]'
        )
        const showIcons = section.querySelectorAll('.show-password')
        const hideIcons = section.querySelectorAll('.hide-password')

        const toggle = () => {
            const isHidden = [...passwordInputs].some((input) => input.type === 'password')
            passwordInputs.forEach((input) => {
                input.type = isHidden ? 'text' : 'password'
            })
            showIcons.forEach((icon) => {
                icon.style.display = isHidden ? 'none' : 'inline'
            })
            hideIcons.forEach((icon) => {
                icon.style.display = isHidden ? 'inline' : 'none'
            })
        }

        iconContainer.addEventListener('click', toggle)
    })

    passwordInput.addEventListener('input', () => {
        const password = passwordInput.value
        const requirements = [
            { regex: /.{12,}/, index: 0 },
            { regex: /[A-Z]/, index: 1 },
            { regex: /[a-z]/, index: 2 },
            { regex: /\d/, index: 3 },
            { regex: /[^a-zA-Z0-9]/, index: 4 },
        ]

        requirements.forEach(({ regex, index }) => {
            const isValid = regex.test(password)
            const checkIcon = document.querySelectorAll('.password-requirement-check')[index]
            const xIcon = document.querySelectorAll('.password-requirement-x')[index]

            checkIcon.style.display = isValid ? 'inline' : 'none'
            xIcon.style.display = isValid ? 'none' : 'inline'
        })
    })
</script>
